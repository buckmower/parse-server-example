<!DOCTYPE html>
   <!--[if lt IE 7]> <html class="ie ie6 lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
   <!--[if IE 7]>    <html class="ie ie7 lt-ie9 lt-ie8"        lang="en"> <![endif]-->
   <!--[if IE 8]>    <html class="ie ie8 lt-ie9"               lang="en"> <![endif]-->
   <!--[if IE 9]>    <html class="ie ie9"                      lang="en"> <![endif]-->
   <!--[if !IE]><!-->
   <html lang="en" class="no-ie">
   <!--<![endif]-->
   
   <head>
      <!-- Meta-->
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
      <meta name="description" content="<%= spherename %> is a Represent.xyz sphere.">
      <meta name="keywords" content="vote, election, group, sphere, nominate, decide">
      <meta name="author" content="">
      <!-- Desktop Browsers -->
      <link rel="shortcut icon" type="image/x-icon" href="../../assets/icons/favicon.ico" />
      
      <!-- Android: Chrome M39 and up-->
      <link rel="manifest" href="../../assets/icons/manifest.json">
      <!-- Android: Chrome M31 and up, ignored if manifest is present-->
      <meta name="mobile-web-app-capable" content="yes">
      <link rel="icon" sizes="192x192" href="../../assets/icons/icon-192x192.png">
      <!-- iOS -->
      <meta name="apple-mobile-web-app-capable" content="yes">
      <meta name="apple-mobile-web-app-title" content="Represent.xyz">
      
      <link rel="apple-touch-icon" sizes="180x180" href="../../assets/icons/apple-touch-icon-180x180-precomposed.png">
      <link href="../../assets/icons/apple-touch-icon-152x152-precomposed.png" sizes="152x152" rel="apple-touch-icon">
      <link href="../../assets/icons/apple-touch-icon-144x144-precomposed.png" sizes="144x144" rel="apple-touch-icon">
      <link href="../../assets/icons/apple-touch-icon-120x120-precomposed.png" sizes="120x120" rel="apple-touch-icon">
      <link href="../../assets/icons/apple-touch-icon-114x114-precomposed.png" sizes="114x114" rel="apple-touch-icon">
      <link href="../../assets/icons/apple-touch-icon-76x76-precomposed.png" sizes="76x76" rel="apple-touch-icon">
      <link href="../../assets/icons/apple-touch-icon-72x72-precomposed.png" sizes="72x72" rel="apple-touch-icon">
      <link href="../../assets/icons/apple-touch-icon-60x60-precomposed.png" sizes="60x60" rel="apple-touch-icon">
      <link href="../../assets/icons/apple-touch-icon-57x57-precomposed.png" sizes="57x57" rel="apple-touch-icon">
      <link href="../../assets/icons/apple-touch-icon-precomposed.png" rel="apple-touch-icon">
      
      <!-- Windows 8 and IE 11 -->
      <meta name="msapplication-config" content="../../assets/icons/browserconfig.xml" />
      
      <!-- Windows -->
      <meta name="application-name" content="Represent.xyz" />
      <meta name="msapplication-tooltip" content="Let's Make Decisions Together!" />
      <meta name="msapplication-window" content="width=1024;height=768" />
      <meta name="msapplication-navbutton-color" content="#007EFF" />
      <meta name="msapplication-starturl" content="../../" />
      <title>Represent.xyz | <%= spherename %></title>
      <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
      <!--[if lt IE 9]><script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script><script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script><![endif]-->
      <!-- Bootstrap CSS-->
      <link rel="stylesheet" href="../../admin/app/css/bootstrap.css">
      <link rel="stylesheet" href="../../admin/app/vendor/datetimepicker/css/bootstrap-datetimepicker.min.css">
      <!-- Vendor CSS-->
      <link rel="stylesheet" href="../../admin/app/vendor/fontawesome/css/font-awesome.min.css">
      <!-- START Page Custom CSS-->
      <!-- END Page Custom CSS-->
      <!-- App CSS-->
      <link rel="stylesheet" href="../../admin/app/css/app.css">
      <link href="../../admin/app/css/cropProfile.css" rel="stylesheet">
      <link href="../../admin/app/css/cropper.css" rel="stylesheet">
      <style>
      textarea {
        	-webkit-box-sizing: border-box;
        	-moz-box-sizing: border-box;
        	box-sizing: border-box;
        
        	width: 100%;
        }
      #logorepred {
        color: #ed0027;
      }
      #logoresblack {
        color: #333333;
      }
      #logoentblue {
        color: #007eff;
      }
      .brand-logo {
        font-size: 28pt;
      }
      </style>
      <link rel="stylesheet" href="../../admin/app/vendor/blueimp-gallery/css/blueimp-gallery.min.css">
      <!-- JavaScript Files -->
      <!-- Modernizr JS Script-->
      <!-- <script src="../admin/app/vendor/modernizr/modernizr.js" type="application/javascript"></script> -->
      <!-- JQuery -->
      <script src="../../admin/app/vendor/jquery/jquery.min.js"></script>
      <script src="../../admin/app/vendor/countdown/jquery.countdown.js"></script>
      <!-- Main vendor Scripts -->
      <script src="../../admin/app/vendor/bootstrap/js/bootstrap.min.js"></script>
      <!-- Datetime Picker -->
      <script src="../../admin/app/vendor/moment/min/moment.min.js"></script>
      <script src="../../admin/app/vendor/datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
      <!-- Stripe Integration -->
      <script src="https://checkout.stripe.com/checkout.js"></script>
      <script>
      $(document).ready(function(){
        var callTheHandler = function(sphereName, sphereObjectID){
          var handler = StripeCheckout.configure({
            key: 'pk_live_MkWV2ySo6LyEV7CNII7PdBi6',
            name: 'Represent.xyz',
            image: '/assets/icons/apple-touch-icon-144x144-precomposed.png',
            locale: 'auto',
            amount: 957,
            description: "1 yr subscription to "+sphereName,
            email: "<%= useremail %>",
            token: function(token) {
              // Use the token to create the charge with a server-side script.
              // You can access the token ID with `token.id`
              $.post("/striperequest", {"tokenid": token.id, "tokenemail": token.email, "spherename": sphereName, "sphereobjectid": sphereObjectID}, function(){
                location.reload(true);
              });
            }
          });
          handler.open();
        };
        $('.paysubscriptionform').on('click', function(e){
          e.preventDefault();
          callTheHandler($(this).data("spherename"), $(this).data("sphereobjectid"));
        });
        // Close Checkout on page navigation
        $(window).on('popstate', function() {
          handler.close();
        });
      });
      </script>
      <!-- Cropper -->
      <script src="../../admin/app/js/cropper.js"></script>
      <script>
          $(document).ready(function() {
          $('#createElectionModal').on('show.bs.modal', function (event) {
              var button = $(event.relatedTarget); // Button that triggered the modal
              var ElectionID = button.data('electionid'); // Extract info from data-* attributes
              var ElectionName = button.data('electionname'); // Extract info from data-* attributes
              var ElectionDescription = button.data('electiondescription'); // Extract info from data-* attributes
              var ElectionEndDate = new Date(); // Extract info from data-* attributes
              //var sphereID = button.data('sphereid'); // Extract info from data-* attributes
              var modal = $(this);
              
              var electionNameInput = $('input[name="electionName"]');
              var electionIDInput = $('input[name="updateElection"]');
              var electionDescriptionInput = $('textarea[name="electionDescription"]');
              var electionEndDateInput = $('input[name="electionEndDateTime"]');
              
              var dateTime = moment().format("MM-DD-YYYY h:mm A");
              modal.find(electionNameInput).val(ElectionName);
              modal.find(electionIDInput).val(ElectionID);
              modal.find(electionDescriptionInput).text(ElectionDescription);
              modal.find(electionEndDateInput).val(dateTime);
            });
      });
      </script>
      <!-- Parse Init -->
      <script src="//www.parsecdn.com/js/parse-1.3.3.min.js"></script>
      <script src="../../admin/app/js/parseInit.js"></script>
      <!-- Election Creation Scripts -->
      <% if((sphereelectioncreationoptions == "open") || (isadmin == true)) { %>
          <script src="../../admin/app/js/editElectionSettingsUI.js"></script>
          <% include /validateCreateElection %>
      <% } %>
      <script>
          $(document).ready(function(){
             $("#choosestringcsv").click(function(){
                $(this).removeClass("btn-default").addClass("btn-primary");
                $("#choosefilecsv").removeClass("btn-primary").addClass("btn-default");
                $("#sphereMemberAddCSVString").removeClass("hidden");
                $("#sphereMemberAddCSVFile").addClass("hidden"); 
             });
             $("#choosefilecsv").click(function(){
                $(this).removeClass("btn-default").addClass("btn-primary");
                $("#choosestringcsv").removeClass("btn-primary").addClass("btn-default");
                $("#sphereMemberAddCSVFile").removeClass("hidden");
                $("#sphereMemberAddCSVString").addClass("hidden");
             });
             $("#showcurrentmembersdivbutton").click(function(){
                $(this).removeClass("btn-default").addClass("btn-primary");
                $("#showinvitedmembersdivbutton").removeClass("btn-primary").addClass("btn-default");
                $("#currentmembersdiv").removeClass("hidden");
                $("#invitedmembersdiv").addClass("hidden");
             });
             $("#showinvitedmembersdivbutton").click(function(){
                $(this).removeClass("btn-default").addClass("btn-primary");
                $("#showcurrentmembersdivbutton").removeClass("btn-primary").addClass("btn-default");
                $("#invitedmembersdiv").removeClass("hidden");
                $("#currentmembersdiv").addClass("hidden");
             });
          });
      </script>
      <script>
          // JavaScript Document
        $(document).ready(function(){
        $("#sphereMemberNameInput").keyup(function() 
        {
        $("#sphereMemberSuggestionsFrame").removeClass("hidden");
        $("#sphereMemberSuggestionsFrame").addClass("show");
        var searchbox = $(this).val();
        var sphereObjectID = $("#sphereObjectIDInput").val();
        var dataString = 'sphere_member_name='+searchbox+'&sphere_object_id='+sphereObjectID;
        if(searchbox === '')
        {}
        else
        {
        $.ajax({
        type: "POST",
        url: "/sphere/<%= sphereobjectid %>/searchmembers",
        data: dataString,
        cache: false,
        success: function(arrayofhtml)
        {
           var str = arrayofhtml.join('');
           $("#sphereMemberSuggestion").html(str).show();
        }
        });
        }return false; 
        });
        $("#dismisssphereMemberSuggestionsButton").click(function(){
           $("#sphereMemberSuggestionsFrame").addClass("hidden");
        });
        });
      </script>
      <script>
          // JavaScript Document
        $(document).ready(function(){
        $("#searchSphereNameInput").keyup(function() 
        {
        $("#suggestionsFrame").removeClass("hidden");
        $("#suggestionsFrame").addClass("show");
        var searchbox = $(this).val();
        var dataString = 'sphere_name='+ searchbox;
        if(searchbox === '')
        {}
        else
        {
        $.ajax({
        type: "POST",
        url: "/sphere/<%= sphereobjectid %>/search",
        data: dataString,
        cache: false,
        success: function(arrayofhtml)
        {
           var str = arrayofhtml.join('');
           $("#suggestion").html(str).show();
        }
        });
        }return false; 
        });
        $("#dismissSuggestionsButton").click(function(){
           $("#suggestionsFrame").addClass("hidden");
        });
        });
      </script>
      <% include /cropSphereProfilePicture %>
      <% include /cropSphereBackgroundPicture %>
   </head>
<body class="">
   <div id="fb-root"></div>
   <% include /settings %>
   <script>
   (function(d, s, id) {
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) return;
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=<%= appid %>&version=v2.3";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
   </script>
   <%
       if((isadmin == true)) {
    %>
            <% include /addSpherePictureModal %>
    <%
       }
    %>
    <% include /sendEmailsModal %>
    <div class="modal fade" id="editsphereModal" tabindex="-1" role="dialog" aria-labelledby="editsphereModal" aria-hidden="true">
       <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <a type="button" class="close" data-dismiss="modal" href="/spheres"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></a>
              <h4 class="modal-title">Sphere Settings</h4>
            </div>
            <div class="modal-body">
            <% if(isadmin == false) { %>
               <p>The settings of this sphere are only configurable by its admins.</p>
               <a class="btn btn-default" data-target="#addAdminsModal" data-dismiss="modal" data-toggle="modal">View Admins</a>
           <% }  else { %>
               <form method="POST" action="/sphere/<%= sphereobjectid %>/editsphere" id="editsphereForm">
                <div class="form-group">
                   <label id="newspherePrivacyInputLabel" class="col-sm-7 control-label">Private Membership</label>
                   <div class="col-sm-5">
                      <label class="switch">
                         <input id="newspherePrivacy" name="newspherePrivacy" type="checkbox" <%= joinselectedprivate %>>
                         <span></span>
                      </label>
                   </div>
                  </div>
                  <div class="form-group">
                   <label id="newsphereElectionCreationOptionsInputLabel" class="col-sm-7 control-label">Only Admins Can Create Elections</label>
                   <div class="col-sm-5">
                      <label class="switch">
                         <input id="newsphereElectionCreationOptions" name="newsphereElectionCreationOptions" type="checkbox" <%= electioncreationoptionsselectedprivate %>>
                         <span></span>
                      </label>
                   </div>
                  </div>
                <div class="form-group">
                  <label for="newsphereNameInput">Sphere Name</label>
                  <input type="text" class="form-control" name="sphereName" id="sphereNameInput" placeholder="Enter New Sphere Name" value="<%= spherename %>">
                </div>
                <div class="form-group">
                  <label for="newsphereDescriptionInput">Sphere Description</label>
                  <textarea class="form-control" name="sphereDescription" id="sphereDescriptionInput"><%= spheredescription %></textarea>
                </div>
                <div class="form-group">
                  <input type="hidden" name="sphereObjectID" id="sphereObjectIDInput" value="<%= sphereobjectid %>">
                  <button type="submit" name="submitNewsphere" class="btn btn-default">Submit Edits</button>
                </div>
              </form>
           <% } %>
           </div>
           <div class="modal-footer">
               <div class="pull-left">
                   <button class="btn btn-sm btn-danger" id="leavespherebutton">Leave</button>
               </div>
               <div class="btn-group pull-right">
                  <% if(isadmin == true) { %>
                  <button class="btn btn-sm btn-default pull-left" id="addAdminsButton" data-toggle="modal" data-target="#addAdminsModal" data-dismiss="modal">Admins</a>
                  <button class="btn btn-sm btn-primary" data-dismiss="modal" data-toggle="modal" data-target="#addPictureModal">Add Images</button>
                  <% } %>
                  <button class="btn btn-sm btn-default" data-dismiss="modal">Close</button>
              </div>
              <div class="clearfix"></div>
           </div>
       </div><!-- /.modal-content -->
     </div><!-- /.modal-dialog -->
   </div><!-- /.modal -->
   <div class="modal fade" id="SphereAlignmentModal" tabindex="-1" role="dialog" aria-labelledby="mergeSpheresModal" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
              <h4 class="modal-title">Sphere Alignment</h4>
            </div>
            <div class="modal-body">
                    <div role="tabpanel">

                      <!-- Nav tabs -->
                      <ul class="nav nav-pills" role="tablist">
                        <li role="presentation" class="active"><a href="#sphereparents" aria-controls="sphereparents" role="tab" data-toggle="tab">Parent</a></li>
                        <li role="presentation"><a href="#spherechildren" aria-controls="spherechildren" role="tab" data-toggle="tab">Children</a></li>
                        <li role="presentation"><a href="#spheresiblings" aria-controls="spheresiblings" role="tab" data-toggle="tab">Siblings</a></li>
                      </ul>
                    
                      <!-- Tab panes -->
                      <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="sphereparents">
                        <% if((typeof sphereparent == "undefined") || (sphereparent == "")) { %>
                            <span style="font-size: 18pt;">No Parent</span>
                        <% } else { %>
                                <br><a href="/sphere/<%= sphereparent['sphereObjectID'] %>" style="font-size: 18pt;"><%= sphereparent['sphereName'] %></a>
                        <% } %>
                        </div>
                        <div role="tabpanel" class="tab-pane" id="spherechildren">
                        <% if(spherechildren.length > 0) { %>
                            <ul style="list-style-type: none; padding-left: 0px;">
                        <%    for(var i = 0; i < spherechildren.length; i++) { 
                               var spherechild = spherechildren[i];
                        %>
                            <li>
                                <a href="/sphere/<%= spherechild['sphereObjectID'] %>" style="font-size: 18pt;"><%= spherechild['sphereName'] %></a>
                            </li>
                        <% }  %>
                            </ul>
                        <% } else { %>
                            <span style="font-size: 18pt;">No Children</span>
                        <% } %>
                        </div>
                        <div role="tabpanel" class="tab-pane" id="spheresiblings">
                            <% if(spheresiblings.length > 0) { %>
                            <ul style="list-style-type: none; padding-left: 0px;">
                            <%  for(var i = 0; i < spheresiblings.length; i++) { 
                                var spheresibling = spheresiblings[i];
                            %>
                                <li>
                                    <a href="/sphere/<%= spheresibling['sphereObjectID'] %>" style="font-size: 18pt;"><%= spheresibling['sphereName'] %></a>
                                </li>
                            <% } %>
                            </ul>
                            <% } else { %>
                               <span style="font-size: 18pt;">No Siblings</span> 
                          <%  } %> 
                        </div>
                      </div>
                    </div>
            </div>
            <div class="modal-footer">
              <% if(isadmin == true){ %>
              <button class="btn btn-default pull-left" data-dismiss="modal" data-toggle="modal" data-target="#mergeSpheresModal">Manage Alignment</button>
              <% } %>
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->
      <div class="modal fade" id="mergeSpheresModal" tabindex="-1" role="dialog" aria-labelledby="mergeSpheresModal" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
              <h4 class="modal-title">Manage Alignment</h4>
            </div>
            <div class="modal-body">
                <div role="tabpanel">

                      <!-- Nav tabs -->
                      <ul class="nav nav-pills" role="tablist">
                        <li role="presentation" id="managesphereparentstabpill" class="active"><a href="#managesphereparents" aria-controls="managesphereparents" role="tab" data-toggle="tab">Parent</a></li>
                        <li role="presentation" id="managespherechildrentabpill"><a href="#managespherechildren" aria-controls="managespherechildren" role="tab" data-toggle="tab">Children</a></li>
                      </ul>
                    
                      <!-- Tab panes -->
                      <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="managesphereparents">
                        <% if((sphereparent == "") && (joinparentrequestsent.length <= 0)) { %>
                            <div id="sphereSearch">
                                 <form role="search" class="navbar-form">
                                    <div class="input-sphere">
                                       <input type="text" id="searchSphereNameInput" placeholder="Start typing to search..." class="form-control">
                                    </div>
                                 </form>
                                 <div class="hidden" id="suggestionsFrame" style="display: inline-block;">
                                   <button id="dismissSuggestionsButton" class="close"><span>&times;</span></button>
                                      <div id="suggestion" style="display: inline-block;">
                                      </div>
                                 </div>
                             </div> 
                           <% } else { 
                               if(sphereparent !== "") {
                           %>
                           <p>Sphere already has <a href="javascript:void(0);" data-dismiss="modal" data-toggle="modal" data-target="#SphereAlignmentModal">parent alignment</a>.</p>
                           <br>
                           <p>Remove <span style="font-size: 18pt;"><%= sphereparent['sphereName'] %></span> as Parent? <button id="removeparent" class="btn btn-sm btn-danger">Remove</button></p>
                           <% } else if(joinparentrequestsent.length > 0) { 
                               var joinparentid = joinparentrequestsent[0]['itemcontent']['parentSphereID'];
                               var joinparentname = joinparentrequestsent[0]['itemcontent']['parentSphereName'];
                           %>
                             <p>Request sent to <a href="/sphere/<%= joinparentid %>"><%= joinparentname %></a>!</p>
                             <form method="POST" action="/sphere/<%= sphereobjectid %>/removemergerequest/<%= joinparentid %>">
                                 <input type="submit" class="btn btn-sm btn-danger" value="Remove Request">
                             </form>
                          <%  } 
                           }%>
                        </div>
                        <div role="tabpanel" class="tab-pane" id="managespherechildren">
                        <% if(spherechildren.length > 0) { %>
                            <ul style="list-style-type: none; padding-left: 0px;">
                        <%    for(var i = 0; i < spherechildren.length; i++) { 
                               var spherechild = spherechildren[i];
                        %>
                            <li>
                                <span class="removespherechild badge" data-childspherename="<%= spherechild['sphereName'] %>" data-childsphereid="<%= spherechild['sphereObjectID'] %>" style="cursor: pointer; color: #FF0000;"> X </span>
                                <a href="/sphere/<%= spherechild['sphereObjectID'] %>" style="font-size: 18pt;"><%= spherechild['sphereName'] %></a>
                            </li>
                        <% }  %>
                            </ul>
                        <% } else { %>
                            <span style="font-size: 18pt;">No Children</span>
                        <% } %>
                        </div>
                      </div>
                    </div>
                </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->
   <div id="blueimp-gallery" class="blueimp-gallery blueimp-gallery-controls">
       <div class="slides"></div>
       <h3 class="title hidden"></h3>
       <a class="prev">‹</a>
       <a class="next">›</a>
       <a class="close">
           <% if(isadmin == true) { %> 
                 <button style="margin-right: 16px;" class="btn btn-sm btn-inverse" id="makeProfileButton">Make Profile</button>
                 <button style="margin-right: 16px;" class="btn btn-sm btn-inverse" data-dismiss="modal" data-target="#addPictureModal" data-toggle="modal" id="addPictureModalLaunchButton">Add</button>
                 <button style="margin-right: 16px;" class="btn btn-sm btn-inverse" id="removePictureButton">Remove</button>
          <% } %>
          <span>×</span>
       </a>
       <a class="play-pause"></a>
       <ol class="indicator"></ol>
   </div>
   <div class="modal fade" id="addAdminsModal" tabindex="-1" role="dialog" aria-labelledby="addAdminsModal" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <a type="button" class="close" data-dismiss="modal" href="/spheres"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></a>
              <h4 class="modal-title">Admins</h4>
            </div>
            <div class="modal-body">
              <div role="tabpanel">
                  <!-- Nav tabs -->
                  <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active"><a href="#currentAdmins" aria-controls="currentAdmins" role="tab" data-toggle="tab">Current</a></li>
                    <% if(isadmin == true){ %>
                    <li role="presentation"><a href="#addAdmins" aria-controls="addAdmins" role="tab" data-toggle="tab">Add</a></li>
                    <% } %>
                  </ul>
                
                  <!-- Tab panes -->
                  <div class="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="currentAdmins">
                        <ul style="list-style-type: none;">
                        <% for(var i=0; i < sphereadminsinsphere.length; i++) {
                            var currentadmin = sphereadminsinsphereinfo[i];
                        %>
                        <li><a href="https://www.facebook.com/<%= currentadmin['admin']['adminfMemberID'] %>"><%= currentadmin['admin']['adminName'] %></a></li>
                        <% } %>
                        </ul>
                    </div>
                 <% if(isadmin == true) { %>
                    <div role="tabpanel" class="tab-pane" id="addAdmins">
                        <div id="sphereMemberSearch">
                         <form role="search" class="navbar-form">
                            <div class="input-group">
                               <input type="text" id="sphereMemberNameInput" placeholder="Start typing to search..." class="form-control">
                               <input type="hidden" name="sphereObjectID" id="sphereObjectIDInput" value="<%= sphereobjectid %>">
                            </div>
                         </form>
                         <div class="hidden" id="sphereMemberSuggestionsFrame" style="display: inline-block;">
                           <button id="dismisssphereMemberSuggestionsButton" class="close"><span>&times;</span></button>
                              <div id="sphereMemberSuggestion" style="display: inline-block;">
                              </div>
                         </div>
                       </div>
                    </div>
                    <% } %>
                  </div>
                
                </div>
            </div>
            <div class="modal-footer">
              <a data-toggle="modal" data-target="#SphereMembersModal" data-dismiss="modal" class="btn btn-md btn-default pull-left">Back to Members</a>
              <a type="button" class="btn btn-default" data-dismiss="modal" href="/spheres">Close</a>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->
   <div class="modal fade" id="SphereMembersModal" tabindex="-1" role="dialog" aria-labelledby="SphereMembersModal" aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
              <h4 class="modal-title">Members</h4>
            </div>
            <div class="modal-body" style="overflow-y: scroll;">
             <% if(isadmin == true) { %>
                <div role="tabpanel">
                      <!-- Nav tabs -->
                      <ul class="nav nav-tabs" role="tablist">
                        <li role="presentation" class="active"><a href="#currentMembers" aria-controls="currentMembers" role="tab" data-toggle="tab">Current</a></li>
                        <li role="presentation"><a href="#addMembers" aria-controls="addMembers" role="tab" data-toggle="tab">Add</a></li>
                      </ul>
                       <!-- Tab panes -->
                      <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="currentMembers">
                            <div class="btn-group" style="margin-bottom: 10px;">
                                <button class="btn btn-sm btn-primary" id="showcurrentmembersdivbutton">Current Members</button>
                                <button class="btn btn-sm btn-default" id="showinvitedmembersdivbutton">Invited Members</button>
                            </div>
                            <div id="currentmembersdiv" class="" style="max-height: 500px; overflow-y: scroll;">
                                <ul style="list-style-type: none; padding-left: 0px;">
                                <%    for(var i=0; i < spheremembersinsphere.length; i++) { 
                                        var spheremember = spheremembersinsphere[i];
                                %>
                                        <li><span class="submitremovemember badge" data-membername="<%= spheremember['name'] %>" data-memberid="<%= spheremember['pUserID'] %>" style="cursor: pointer; color: #FF0000;"> X </span>
                                        <a href="https://www.facebook.com/<%= spheremember['fMemberID'] %>"><%= spheremember['name'] %></a></li>
                                    <% } %>
                                </ul>
                            </div>
                            <div id="invitedmembersdiv" class="hidden" style="max-height: 500px; overflow-y: scroll;">
                                <div class="row">
                                    <div class="col-sm-4 pull-right" style="text-align: left;">
                                      <%  if(spheremembersinvitedtosphere.length > 0) { %>
                                        <button id="clearallinvitesbutton" class="btn btn-sm btn-danger" style="display: inline-block;">Clear All Invites</button>
                                      <% } %>
                                    </div>
                                    <div class="col-sm-8 pull-left" style="overflow: scroll;">
                                    <br>
                                        <% 
                                    if(spheremembersinvitedtosphere.length > 0) { %>
                                       <ul style="list-style-type: none; padding-left: 0px; margin-left: 0px;">
                                     <%
                                      for(var i=0; i < spheremembersinvitedtosphere.length; i++) { 
                                            var spherememberinvited = spheremembersinvitedtosphere[i];
                                            if(spherememberinvited['joined'] == true) {
                                                var didspherememeberjoin = "joined";
                                            } else {
                                                var didspherememeberjoin = "";
                                            }
                                      %> 
                                      <li>
                                      <span class="submitdeleteinvite badge" data-email="<%= spherememberinvited['email'] %>" data-inviteid="<%= spherememberinvited['id'] %>" style="cursor: pointer; color: #FF0000;"> X </span>
                                      <%= spherememberinvited['email'] %>
                                      <span class="badge" style="color: #333;"><%= didspherememeberjoin %></span>
                                      </li>
                                      <br>
                                    <%  } %>
                                    </ul>
                                   <% } else { %>
                                   <br>
                                   <a href="#addMembers" aria-controls="addMembers" data-toggle="tab" class="btn btn-primary btn-sm">Invite Members</a>
                                   <br>
                                   <% } %>
                                   </div>
                                   <div class="clearfix"></div>
                                </div>
                            </div>
                        </div>
                        <div role="tabpanel" class="tab-pane" id="addMembers">
                            <div class="btn-group" style="margin-bottom: 10px;">
                                <button class="btn btn-sm btn-primary" id="choosestringcsv">Paste In</button>
                                <button class="btn btn-sm btn-default" id="choosefilecsv">Upload File</button>
                            </div>
                            <div id="sphereMemberAddCSVString">
                             <form id="sphereMemberAddCSVStringForm">
                                 <textarea id="csvstringofinvitedmembers" name="csvstringofinvitedmembers" rows="9">Paste in Email Addresses Seperated By Commas and a Single Space</textarea>
                                 <br>
                             </form>
                            <button id="submitcsvstringofinvitedmembers" class="btn btn-sm btn-primary">Add Members</button>
                           </div>
                           <div id="sphereMemberAddCSVFile" class="hidden">
                             <form id="sphereMemberAddCSVFileForm">
                                 <input id="csvfileofinvitedmembers" name="csvfileofinvitedmembers" type="file" accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel" />
                                 <br>
                             </form>
                            <button id="submitcsvfileofinvitedmembers" class="btn btn-sm btn-primary">Add Members</button>
                           </div>
                        </div>
                     </div>
                </div>
                <% } else {
                       for(var i=0; i < spheremembersinsphere.length; i++) { 
                            var spheremember = spheremembersinsphere[i];
                        %>
                            <a href="https://www.facebook.com/<%= spheremember['fMemberID'] %>"><%= spheremember['name'] %>,</a>
                    <% } %>
                
                <% } %>
            </div>
            <div class="modal-footer">
            <% if(isadmin == true) { %>
              <div class="btn-group pull-left">
                  <a href="/sphere/<%= sphereobjectid %>/members?s=sendemails" class="btn btn-sm btn-default">Send Emails</a>
                  <button type="button" class="btn btn-sm btn-default" data-dismiss="modal" data-target="#showAllEmails" data-toggle="modal">Show Emails</button>
              </div>
            <% } %>
              <button type="button" class="btn btn-sm btn-default" data-dismiss="modal">Close</button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->
<% 
if(ismembercurrentwithsubscription){
if((sphereelectioncreationoptions == "open") || (isadmin == true)) { %>
 <div class="modal fade" id="createElectionModal" tabindex="-1" role="dialog" aria-labelledby="createElectionModal" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title">Ask For Input</h4>
      </div>
      <div class="modal-body" id="createElectionModalBody">
        <div id="electionCreationErrors" class="alert alert-warning hidden" style="color: #000;" role="alert">
            <button id="dismissalert" type="button" class="close" data-dismiss="alert" aria-label="Close Errors"><span aria-hidden="true">&times;</span></button>
            <ul id="listoferrors"></ul>
        </div>
        <div class="btn-sphere" role="sphere" aria-label="Step-by-step election creation process" style="padding-bottom: 20px;">
          <button id="createElectionStep1Button" type="button" class="btn btn-default btn-lg">Step 1</button>
          <button id="createElectionStep2Button" type="button" class="btn btn-default btn-lg">Step 2</button>
          <button id="createElectionStep3Button" type="button" class="btn btn-default btn-lg">Step 3</button>
        </div>
        <form>
           <fieldset id="createElectionInputs1">
               <h3 style="display: inline;">Input Rules</h3>
               <div class="row">
                   <div class="col-lg-8">
                       <div class="radio">
                          <label>
                            <input type="radio" name="electionType" id="optionsRadios1" value="open" checked>
                             1) Everyone in the sphere can make as many nominations as they would like. 
                          </label>
                        </div>
                        <div class="radio">
                          <label>
                            <input type="radio" name="electionType" id="optionsRadios2" value="closed">
                            2) Only you as the election administrator can make nominations.
                          </label>
                        </div>
                        <div class="radio">
                          <label>
                            <input type="radio" name="electionType" id="optionsRadios3" value="1per">
                            3) Everyone in the sphere is allowed a single nomination.
                          </label>
                        </div>
                        <div class="radio">
                          <label>
                            <input type="radio" name="electionType" id="optionsRadios4" value="custom">
                            4) Everyone in the sphere is allowed a custom number of nominations.
                          </label>
                        </div>
                        <div id="nominationsalloweddiv" class="hidden">
                            <label for="nominationsallowed">Number of Nominations Allowed Per Member</label>
                            <input type="number" id="nominationsallowed" name="nominationsallowed" min="1" value="1">
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="well" style="margin-top: 10px;">
                            <h4>Limit Nominees to Sphere Members?</h4>
                            <div class="form-group">
                               <label id="switchnomineelimitedlabel" class="col-sm-2 control-label">No</label>
                               <div class="col-sm-10">
                                  <label class="switch">
                                     <input id="switchnomineelimitedinput" name="switchnomineelimitedinput" type="checkbox" value="true">
                                     <span></span>
                                  </label>
                               </div>
                            </div>
                        </div>
                    </div>
                </div>
           </fieldset>
           <fieldset id="createElectionInputs2" class="hidden">
               <h3>Host Settings</h3>
               <label for="electionEndDatePicker">End Date</label>
               <div id="electionEndDatePicker" class="datetimepicker input-group date mb-lg">
                 <input type="text" name="electionEndDateTime" class="form-control">
                 <span class="input-group-addon">
                    <span id="dateTimeIcon" class="fa-calendar fa"></span>
                 </span>
               </div>
               <label for="electionNameInput">Name</label>
               <div class="form-group">
                  <input type="text" id="electionNameInput" name="electionName" placeholder="name of election" class="form-control">
               </div>
               <label for="electionDescription">Description</label>
               <div class="form-group">
                  <textarea class="form-control" id="electionDescription" name="electionDescription" rows="4" value=""></textarea>
               </div>
            </fieldset>
            <fieldset id="createElectionInputs3" class="hidden" style="padding-top: 20px;">
              <div class="col-lg-8">
                <h3>Input Type</h3>
                <div class="radio">
                  <label>
                    <input type="radio" name="newVoteOrEval" id="newofvotetyperadio" value="vote" checked>
                    Votes
                  </label>
                </div>
                <div class="radio">
                  <label>
                    <input type="radio" name="newVoteOrEval" id="newofevaltyperadio" value="evaluation">
                    Evaluations
                  </label>
                </div>
                <div class="radio">
                  <label>
                    <input type="radio" name="newVoteOrEval" id="newofbudgettyperadio" value="allocation">
                    Budget Allocation
                  </label>
                </div>
                <div class="form-group" id="newvotesallowedinput" style="padding-top: 20px;">
                   <p>Choosing the Voting input type enables you to allot an <u>equal and limited amount</u> of votes to each member of the sphere. </p>
                   <label for="newElectionVotesAllowed">Votes Allowed Per Person</label>
                   <input type="number" min="1" max="" name="newElectionVotesAllowed" value="1">
                </div>
                <div class="form-group hidden" id="newrangedefinitioninput" style="padding-top: 20px;">
                   <p>Choosing the Evaluations input type enables each member of the sphere to rate <u>each nomination</u> according to a set scale.</p>
                   <label for="newRangeDefinition">Set Scale</label>
                   <select name="newRangeDefinition" class="form-control">
                       <option value="undefined">Choose A Range</option>
                       <option value="zerototen">0 to 10</option>
                       <option value="zerotohundred">0 to 100</option>
                   </select>
                </div>
                <div class="form-group hidden" id="newbudgetdefinitioninput" style="padding-top: 20px;">
                   <p>Choosing the Budget Allocation input type enables each member of the sphere to make an allocation to each nomination from a <u>limited total budget</u>.</p>
                   <label for="newBudgetDefinition">Total Budget</label>
                   <input type="number" min="1" max="" length="8" name="newBudget" value="1">
                </div>
              </div>
              <div class="col-lg-4">
                <div class="well" style="margin-top: 10px;">
                    <h4>Allow Comments on Election Page?</h4>
                    <div class="form-group">
                       <label id="switchcommentsonelectionallowedlabel" class="col-sm-2 control-label">No</label>
                       <div class="col-sm-10">
                          <label class="switch">
                             <input id="switchcommentsonelectionallowedinput" name="switchcommentsonelectionallowedinput" type="checkbox">
                             <span></span>
                          </label>
                       </div>
                    </div>
                </div>
              </div>
            </fieldset>
        </form>
        <button class="btn btn-md btn-primary hidden" id="submitNewElectionButton">Create Election</button>
        <button id="createElectionNextStep2Button" class="btn btn-primary btn-md">Next</button>
        <button id="createElectionNextStep3Button" class="btn btn-primary btn-md hidden">Next</button>
     </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<% }
} else { %>
 <div class="modal fade" id="createElectionModal" tabindex="-1" role="dialog" aria-labelledby="createElectionModal" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title">Ask For Input</h4>
      </div>
      <div class="modal-body">
        <p>Thanks for participating on Represent.xyz. In order to run a sustainable business and provide this service, Represent.xyz charges a subscription fee. Your subscription to this sphere has expired. Visit your <a href="/subscriptions">Subscription Page</a> to maintain access to this sphere.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<% } %>
   <!-- START Main wrapper-->
      <section class="wrapper">
         <!-- START Top Navbar-->
         <nav role="navigation" class="navbar navbar-default navbar-top navbar-fixed-top">
            <!-- START navbar header-->
            <div class="navbar-header" style="background-color: #ffffff;">
               <a href="#" class="navbar-brand">
                  <div class="brand-logo"><span id="logorepred">rep</span><span id="logoresblack">res</span><span id="logoentblue">ent</span>.xyz</div>
                  <div class="brand-logo-collapsed"><img class="img img-responsive" src="../../assets/icons/apple-touch-icon-57x57-precomposed.png"></div>
               </a>
            </div>
            <!-- END navbar header-->
            <!-- START Nav wrapper-->
            <div class="nav-wrapper">
               <!-- START Left navbar-->
               <ul class="nav navbar-nav">
                  <li>
                     <a href="#" data-toggle="aside">
                        <em class="fa fa-align-left"></em>
                     </a>
                  </li>
               </ul>
               <!-- END Left navbar-->
               <!-- START Right Navbar-->
               <ul class="nav navbar-nav navbar-right">
                  <!-- START Alert menu-->
                        <li class="dropdown">
                           <a href="javascript:void(0);" data-toggle="dropdown" data-play="bounceIn" class="dropdown-toggle" aria-expanded="false">
                              <em class="fa fa-user"></em>
                           </a>
                           <!-- START Dropdown menu-->
                           <ul class="dropdown-menu" style="">
                              <li style="padding: 20px 10px;"><a href="javascript:void(0);" id="inviteFriends">
                                 <em class="fa fa-facebook text-muted"></em> - Invite Friends</a>
                              </li>
                              <li style="padding: 20px 10px;"><a href="/me">
                                 <em class="fa fa-cog text-muted"></em>Settings</a>
                              </li>
                              <li style="padding: 20px 10px;"><a href="/logout">
                                 <em class="fa fa-sign-out text-muted"></em>Logout</a>
                              </li>
                     </ul>
                     <!-- END Dropdown menu-->
                  </li>
                  <!-- END Alert menu-->
                  <!-- END User menu-->
                  <!-- START Contacts button-->
                  <!-- <li>
                     <a href="#" data-toggle="offsidebar">
                        <em class="fa fa-align-right"></em>
                     </a>
                  </li> -->
                  <!-- END Contacts menu-->
               </ul>
               <!-- END Right Navbar-->
            </div>
            <!-- END Nav wrapper-->
         </nav>
         <aside class="aside">
         <!-- START Sidebar (left)-->
         <nav class="sidebar">
            <ul class="nav">
               <!-- START user info-->
               <li>
                  <div class="item user-block" id="userProfile">
                     <!-- User picture-->
                     <% if(userprofileimageurl !== null) { %>
                     <div class="user-block-picture">
                        <img src="<%= userprofileimageurl %>" alt="<%= username %>" width="60" height="60" class="img-thumbnail img-circle">
                     </div>
                     <% } %>
                     <!-- Name and Role-->
                     <div class="user-block-info">
                        <span class="user-block-name"><%= username %></span>
                     </div>
                  </div>
               </li>
               <!-- END user info-->
               <!-- START Menu-->
               <li class="">
                  <a href="/spheres" title="spheres">
                     <em class="fa fa-circle"></em>
                     <div class="label label-primary pull-right"><%= numberofuserspheres %></div>
                     <span class="item-text" style="padding-right: 15px;">Spheres</span>
                  </a>
               </li>
               <li class="">
                  <a href="/votes" title="votes">
                     <em class="fa fa-star"></em>
                     <div class="label label-primary pull-right"><%= numberofuservotescast %></div>
                     <span class="item-text" style="padding-right: 15px;">Votes</span>
                  </a>
               </li>
               <li class="">
                  <a href="/admin" title="admin">
                     <em class="fa fa-lock"></em>
                     <div class="label label-primary pull-right"><%= numberofadminactionitems %></div>
                     <span class="item-text" style="padding-right: 15px;">Admin</span>
                  </a>
               </li>
               <li class="">
                  <a href="/decisions" title="decisions">
                     <em class="fa fa-compass"></em>
                     <div class="label label-primary pull-right"><%= numberofdecisions %></div>
                     <span class="item-text" style="padding-right: 15px;">Decisions</span>
                  </a>
               </li>
               <!-- END Menu-->
               <!-- Sidebar footer -->
               <li class="nav-footer">
                  <div class="nav-footer-divider"></div>
                  <!-- START button sphere-->
                  <div class="btn-sphere text-center">
                     <a href="/me" type="button" data-toggle="tooltip" data-title="Settings" class="btn btn-link">
                        <em class="fa fa-cog text-muted"></em>
                     </a>
                     <a href="/logout" type="button" data-toggle="tooltip" data-title="Logout" class="btn btn-link">
                        <em class="fa fa-sign-out text-muted"></em>
                     </a>
                  </div>
                  <!-- END button sphere-->
               </li>
            </ul>
         </nav>
         <!-- END Sidebar (left)-->
      </aside>
      <!-- End aside-->
      <!-- START Main section-->
      <section>
         <!-- START Page content-->
         <section class="main-content" style="min-height: 600px;">
          <% if(showsubscriptionwarning){ %>
          <div class="alert alert-warning hidden" role="alert">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
            <span id="subscriptionwarningmessages"><%= subscriptionwarningmessage %></span>
            <br>
            <%= stripecheckoutform %>
          </div>
          <% } %>
            <div class="panel widget" style="max-width: 971px;">
               <% if ((sphereprofilepicture !== "") || (spherebackgroundpictureexists)) { %>
               <div class="half-float">
                  <img id="sphereBackgroundImage" src="<%= spherebackgroundpicture %>" class="img img-responsive" style="display: inline-block;">
                  <% if (sphereprofilepicture !== "") { %>
                  <div class="half-float-bottom">
                    <img id="sphereFirstImage" src="<%= sphereprofilepicture %>" title="<%= spherename %>" class="img img-responsive" style="display: inline-block;">
                  </div>
                  <% } %>
               </div>
               <% } %>
                <div class="row row-table text-center hidden">
                 <div class="col-xs-12">
                    <div id="links">
                       <% 
                       if(spherepictureurls.length > 0) {
                           for(var i = 0; i < spherepictureurls.length; i++) {
                             var pictureurl = spherepictureurls[i];
                             var thispictureurl = pictureurl['pictureurl'] || "../assets/representUserDefaultProfilePicture-256.png";
                             var thispictureid = pictureurl['pictureid'] || "0";
                             var thispicturethumbnail = pictureurl['thumbnail'] || "../assets/representUserDefaultProfilePicture-60.png";
                       %>
                           <a href="<%= thispictureurl %>" data-pictureid="<%= thispictureid %>" title="<%= spherename %>">
                               <img src="<%= thispicturethumbnail %>" alt="<%= spherename %>">
                           </a>
                           <%
                           }
                       }
                       %>
                    </div>
                 </div>
              </div>
               <div class="panel-body text-center">
                  <h3 class="m0"><%= spherename %></h3>
                  <p><%= spheredescription %></p>
               </div>
               <div class="panel-body text-center bg-gray-lighter">
                  <div class="row row-table">
                     <div class="col-xs-6">
                        <a href="/sphere/<%= sphereobjectid %>/members" id="sphereMembershipButton" style="display: inline-block;" class="btn btn-md btn-default">Membership</a>
                     </div>
                     <div class="col-xs-6">
                        <button data-toggle="modal" data-target="#SphereAlignmentModal" style="display: inline-block;" class="btn btn-md btn-default">Alignment</button>
                     </div>
                  </div>
                  <div class="row">
                      <div class="col-xs-12">
                          <div class="hidden-lg" style="padding-top: 15px;"></div>
                          <div class="btn-group">
                            <button class="btn btn-danger editsphereLaunchButton" style="width: 110px;" data-toggle="modal" data-target="#editsphereModal">Settings</button>
                            <% if(sphereelectioncreationoptions == "closed") { %>
                                <% if(isadmin == true) { %>
                                    <button class="btn btn-primary btn-md" data-toggle="modal" style="width: 110px;" data-target="#createElectionModal">Ask For Input</button>
                                <% } %>
                            <% } else if(sphereelectioncreationoptions == "open") { %>
                                    <button class="btn btn-primary btn-md" data-toggle="modal" style="width: 110px;" data-target="#createElectionModal">Ask For Input</button>
                            <% } %>
                        </div>
                      </div>
                  </div>
               </div>
            </div>
            <ul class="timeline" id="listofnotifications">
            <%
            if(ismembercurrentwithsubscription){
            if((typeof electionsinsphere !== "undefined") && (electionsinsphere !== "") && (electionsinsphere !== null)) {
               for(var i=0; i < electionsinsphere.length; i++){
                  var electioninsphere = electionsinsphere[i];
                  if((i == 0) || ((i % 2) == 0)) {
                     var leftright = "left";
                     var inverted = "";
                  } else {
                     var leftright = "right";
                     var inverted = "timeline-inverted";
                  }
               %>
               <li class="electionitem <%= inverted %>">
                  <div class="timeline-badge primary">
                      <em class="fa fa-flag"></em>
                  </div>
                  <div class="timeline-date">
                      <time class="endDate" data-unixdate="<%= electioninsphere["electionEndDateUnix"] %>" datetime=""></time>
                  </div>
                  <div class="timeline-panel">
                     <div class="popover <%= leftright %>">
                         <div class="arrow"></div>
                         <div class="popover-title endDate" data-unixdate="<%= electioninsphere["electionEndDateUnix"] %>">
                             <span class="electiontitle" style="font-size: 18pt;"><a href="/sphere/<%= sphereid %>/election/<%= electioninsphere['electionID'] %>"><%= electioninsphere['electionName'] %></a></span>
                             <span style="color: #000;" class="badge"></span>
                         </div>
                         <div class="popover-content" style="padding-left: 10px;">
                              <p><%= electioninsphere['electionDescription'] %></p>
                         </div>
                      </div>
                  </div>
               </li>
               <% } 
               } else {
               %>
               <li class="electionitem">
                  <div class="timeline-badge primary">
                      <em class="fa fa-thumbs-up"></em>
                  </div>
                  <div class="timeline-date">
                      <time id="nowsthetime" datetime=""></time>
                  </div>
                  <div class="timeline-panel">
                     <div class="popover left">
                         <div class="arrow"></div>
                         <div class="popover-content" style="padding: 0px 10px;">
                             <% if(sphereelectioncreationoptions == "open") { %>
                             <h3>Create an election to <a href="javascript:void(0)" data-toggle="modal" data-target="#createElectionModal">ask for input</a> from members of <%= spherename %></h3>
                             <% } else { 
                             if(isadmin == false) {
                             %>
                             <h3>The admins of this sphere have not created any elections yet.</h3>
                             <% } else { %>
                             <h3>Create an election to <a href="javascript:void(0)" data-toggle="modal" data-target="#createElectionModal">ask for input</a> from members of <%= spherename %></h3>
                            <%     }
                             } %>
                         </div>
                     </div>
                  </div>
               </li>
             <% } 
           } else { %>
            <li class="electionitem">
                  <div class="timeline-badge primary">
                      <em class="fa fa-thumbs-up"></em>
                  </div>
                  <div class="timeline-date">
                      <time id="nowsthetime" datetime=""></time>
                  </div>
                  <div class="timeline-panel">
                     <div class="popover left">
                         <div class="arrow"></div>
                         <div class="popover-content" style="padding: 0px 10px;">
                             <h3>Your subscription to this sphere has expired.</h3><br>
                             <button class="btn btn-primary paysubscriptionform" data-sphereobjectid='<%= sphereobjectid %>' data-spherename='<%= spherename %>'>Pay with Card</button>
                         </div>
                     </div>
                  </div>
               </li>
           <% } %>
            </ul>
              <% if(numberofelections > 20) { %>
              <nav>
              <ul class="pagination">
                <li class="<%= previousdisabled %>">
                  <a href="/sphere/<%= sphereid %>?page=<%= previouspage %>" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                  </a>
                </li>
               <% for(var i=0; i < numberofchunksofelections; i++) { 
                   if(i == currentpage){
                       var active = "active";
                   } else {
                       var active = "";
                   }
               %>
                        <li class="<%= active %>"><a href="/sphere/<%= sphereid %>?pg=<%= i %>"><%= i + 1 %></a></li>
               <% } %>
               <li class="<%= nextdisabled %>">
                  <a href="/sphere/<%= sphereid %>?page=<%= nextpage %>" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                  </a>
                </li>
              </ul>
            </nav>
            <% } %>
            </div>
         </section>
         <!-- END Page content -->
      </section>
      <!-- END Main section -->
   </section>
   <!-- END Main wrapper -->
   <!-- START Scripts -->
   <script src="../../../admin/app/vendor/blueimp-gallery/js/blueimp-gallery.min.js"></script>
   <script src="../../../admin/app/vendor/filestyle/bootstrap-filestyle.min.js"></script>
   <script src="../../../admin/app/vendor/jquery/jquery.csv-0.71.min.js"></script>
   <!-- App Main-->
   <% if(isadmin == true) { %>
   <script>
       $(document).ready(function(){
           $("#removeparent").click(function(){
              $.post("/sphere/<%= sphereobjectid %>/removeparent", {}, function(){
                 location.reload(true); 
              }); 
           });
           $(".removespherechild").click(function(){
                var childspherename = $(this).data("childspherename");
                if(!confirm("Are you sure you want to remove alignment with "+childspherename+"?")){
                  return false;
                } else {
                  var childsphereid = $(this).data("childsphereid");
                  $.post("/sphere/<%= sphereobjectid %>/removechild/"+childsphereid, {}, function(){
                      window.location.assign("/sphere/<%= sphereobjectid %>?success=removedchildsphere");
                  });
                }
           });
       });
   </script>
   <% } %>
   <script>
   $(document).ready(function(){
       function getUrlParameter(sParam)
        {
            var sPageURL = window.location.search.substring(1);
            var sURLVariables = sPageURL.split('&');
            for (var i = 0; i < sURLVariables.length; i++) 
            {
                var sParameterName = sURLVariables[i].split('=');
                if (sParameterName[0] == sParam) 
                {
                    return sParameterName[1];
                }
            }
        }
        var rparams = getUrlParameter("success");
        var eparams = getUrlParameter("error");
        var nosubject= getUrlParameter("nosubject");
        var nomessage = getUrlParameter("nomessage");
        if((rparams == "invitedeleted") || (rparams == "addedMembers")) {
          $("#SphereMembersModal").modal("show");
          $("#invitedmembersdiv").removeClass("hidden");
          $("#currentmembersdiv").addClass("hidden");
          $("#showinvitedmembersdivbutton").addClass("btn-primary").removeClass("btn-default");
          $("#showcurrentmembersdivbutton").addClass("btn-default").removeClass("btn-primary");
        }
        if(rparams == "removedchildsphere"){
            $("#mergeSpheresModal").modal("show");
            $("#managesphereparentstabpill").removeClass("active");
            $("#managesphereparents").removeClass("active");
            $("#managespherechildren").addClass("active");
            $("#managespherechildrentabpill").addClass("active");
        }
        if(rparams == "emailsent"){
            $("#sentEmailModal").modal("show");
        }
        if(rparams == "sentemails"){
            $("#showAllEmails").modal("show");
        }
        if(eparams == "sendemailerror"){
           $("#sendEmailsModal").modal("show");
           $("#sendemailerrorsdiv").removeClass("hidden");
           if(nosubject == "1"){
               $("#noemailsubjecterror").removeClass("hidden");
           }
           if(nomessage == "1"){
               $("#noemailmessagerror").removeClass("hidden");
           }
        }
        if(eparams == "profileimagetoosmall"){
          $("#addPictureModal").modal("show");
          $("#profile-picture-alert").parent().removeClass("hidden");
          $("#profile-picture-alert").html("Please Upload an Image with Dimensions of 256 x 256 or bigger");
        }
        if(eparams == "backgroundpicturetoosmall"){
          $("#addBackgroundPictureModal").modal("show");
          $("#background-picture-alert").parent().removeClass("hidden");
          $("#background-picture-alert").html("Please Upload an Image with Dimensions of 972 x 261 or bigger");
        }
   });
   </script>
    <script>
      $(document).ready(function() {
         $("#userProfile").click(function() {
            window.location.href = '/profile';
         });
         $("#inviteFriends").click(function() {
            var message = encodeURIComponent("<%= username %> invites you to join <%= spherename %>");
            window.top.location.href = 'https://www.facebook.com/dialog/apprequests?app_id=<%= appid %>&message='+message+'&redirect_uri=https://<%= appurl %>/sphere/<%= sphereid %>';
         });
         $("#leavespherebutton").on("click", function(){
              if((<%= sphereisonlyaparent %> == false) && (<%= numspheremembersinsphere %> == 1)) {
                   if(!confirm("You are the only person in this sphere, so it will be deleted if you leave! Are you sure you want to leave this sphere?")){
                      return false;
                    } else {
                      $.post("/spheres/leavesphere", {sphereObjectID: "<%= sphereobjectid %>"}, function(){
                          window.location.assign("/spheres");
                      });
                    }
              } else if((<%= sphereisonlyaparent %> == false) && (<%= numspheremembersinsphere %> > 1)) {
                    if(!confirm("Are you sure you want to leave this sphere?")){
                      return false;
                    } else {
                      $.post("/spheres/leavesphere", {sphereObjectID: "<%= sphereobjectid %>"}, function(){
                          window.location.assign("/spheres");
                      });
                    }
              } else if((<%= sphereisonlyaparent %> == true) && (<%= numspheremembersinsphere %> == 1)) {
                if(!confirm("You are the only person in this sphere! Are you sure you want to leave? The sphere will be deleted!")){
                  return false;
                } else {
                  $.post("/spheres/leavesphereparent", {sphereObjectID: "<%= sphereobjectid %>"}, function(){
                      window.location.assign("/spheres");
                  });
                }
              } else if((<%= sphereisonlyaparent %> == true) && (<%= numspheremembersinsphere %> > 1)) {
                if(!confirm("Are you sure you want to leave?")){
                  return false;
                } else {
                  $.post("/spheres/leavesphereparent", {sphereObjectID: "<%= sphereobjectid %>"}, function(){
                      window.location.assign("/spheres");
                  });
                }
              }
           });
         moment().unix();
         $(".endDate").each(function(){
            var enddate = $(this).data("unixdate");
            var endformattedforcountdown = moment.unix(enddate).format('L HH:mm:ss');
            var endformattedforfinish = moment.unix(enddate).format('L hh:mm a');
            $(this).countdown(endformattedforcountdown, function(event) {
               $(this).not(".popover-title").text(event.strftime('Ends in %D days %H hours : %M minutes : and %S seconds'));
            }).on('finish.countdown', function(event) {
               $(this).not(".popover-title").html('The Results Are In! The election ended '+ endformattedforfinish);
               if($(document).width() < 700) {
                   $(this).find(".badge").html(" Resolved ");
               }
            });
         });
         $(".emailsentondate").each(function(){
            var datesent = $(this).data("unixdate");
            var datesentformatted = moment.unix(datesent).format('L hh:mm a');
            $(this).text(datesentformatted);
         });
         if($(document).width() < 700) {
           $("#listofnotifications").removeClass("timeline").css({"list-style-type": "none", "margin-left": "0px", "padding-left": "0px"});
           $(".timeline-badge").children().remove();
           $(".timeline-badge").removeClass("timeline-badge");
           $(".endDate").not(".popover-title").hide();
           $(".timeline-date").removeClass();
           $(".electionenddatediv").hide();
           $(".electiontitle").css("font-size", "12pt");
           $(".timeline-panel").removeClass("timeline-panel");
           $(".electionitem").removeClass("timeline-inverted").css({"background-color": "#fff", "padding": "10px 0px", "margin": "10px 0px", "width": "100%"});
           $(".popover").removeClass();
           $(".arrow").hide();
           $(".popover-content").removeClass();
         }
      });
   </script>
   <% if(isadmin) { %>
   <script>
   var submitcsvfilebutton = document.getElementById("submitcsvfileofinvitedmembers");
   var csvofinvites = document.getElementById("csvfileofinvitedmembers");
   csvofinvites.addEventListener("change", prepareFile); // FileList object
   function prepareFile(evt) {
       var file = evt.target.files[0];
       var reader = new FileReader();
       reader.readAsText(file);
       reader.onload = function(event){
           var csv = event.target.result;
           var results = $.csv.toArray(csv);
           submitcsvfilebutton.addEventListener('click', submitResultsOfCSV(results));
       }
   }
    var submitcsvstringbutton = document.getElementById("submitcsvstringofinvitedmembers");
    submitcsvstringbutton.addEventListener('click', prepareString);
    function prepareString(){
        var stringelement =  document.getElementById("csvstringofinvitedmembers");
        var string = stringelement.value;
        var array = $.csv.toArray(string);
        submitResultsOfCSV(array);
    }
    function submitResultsOfCSV(results) {
        if (results.length > 0) {
    		 $.post("/sphere/<%= sphereobjectid %>/invitespheremembers", {'membersToAddToSphere[]': results}, function(){
    		  window.location.assign("/sphere/<%= sphereobjectid %>?success=addedMembers");
    		 });
    	}
    }
   </script>
   <% } %>
   <% if(isadmin) { %>
   <script>
   $(".submitdeleteinvite").on("click", function(){
        var emailtodelete = $(this).data("email");
        if(!confirm("Are you sure you want to delete "+emailtodelete+"?")){
          return false;
        } else {
          var inviteiddata = $(this).data("inviteid");
          $.post("/sphere/<%= sphereobjectid %>/deleteinvite", {'inviteid': inviteiddata}, function(){
              window.location.assign("/sphere/<%= sphereobjectid %>?success=invitedeleted");
          });
        }
   });
   $(".submitremovemember").on("click", function(){
        var membername = $(this).data("membername");
        if(!confirm("Are you sure you want to remove "+membername+" from the sphere?")){
          return false;
        } else {
          var memberid = $(this).data("memberid");
          $.post("/sphere/<%= sphereobjectid %>/removemember/"+memberid, {}, function(){
              window.location.assign("/sphere/<%= sphereobjectid %>?success=removedmember");
          });
        }
    });
   $("#clearallinvitesbutton").on("click", function(){
       if(!confirm("Are you sure you want to delete all invites?")){
          return false;
        } else {
          $.post("/sphere/<%= sphereobjectid %>/deleteallinvites", {}, function(){
              window.location.assign("/sphere/<%= sphereobjectid %>?success=invitedeleted");
          });
        }
   });
   </script>
   <% } %>
   <script>
   $(document).ready(function(){
         $("#sphereFirstImage").on("click", function(event){
            displayGallery();
         });
         function displayGallery() {
            var gallery = $("#links");
            var links = gallery.find("a");
            var options = {
               onopened: function (event) {
                  // Callback function executed when the Gallery has been initialized
                  // and the initialization transition has been completed.
                  var removePictureButton = $("#removePictureButton");
                  var pictureid = links.eq(0).data("pictureid");
                  removePictureButton.unbind().on("click", {removepictureid: pictureid}, function(event){
                    if (!confirm("Are you sure you want to delete?")){
                      return false;
                    } else {
                       $.post("/sphere/<%= sphereobjectid %>/picture/"+event.data.removepictureid+"/remove", {}, function(){
                           location.reload(true);
                       });
                    }
                     event.stopPropagation();
                  });
                  var makeprofilebutton = $("#makeProfileButton");
                  makeprofilebutton.unbind().on("click", {profilepictureid: pictureid}, function(event){
                     $.post("/sphere/<%= sphereobjectid %>/picture/"+event.data.profilepictureid+"/makeprofile",{}, function(){
                          location.reload(true);
                      }); 
                  });
               },
               onslide: function (index, slide) {
                  // Callback function executed on slide change.
                  var removePictureButton = $("#removePictureButton");
                  var pictureid = links.eq(index).data("pictureid");
                  removePictureButton.unbind().on("click", {removepictureid: pictureid}, function(event){
                    if (!confirm("Are you sure you want to delete?")){
                      return false;
                    } else {
                       $.post("/sphere/<%= sphereobjectid %>/picture/"+event.data.removepictureid+"/remove", {}, function(){
                           location.reload(true);
                       });
                    }
                     event.stopPropagation();
                  });
                  var makeprofilebutton = $("#makeProfileButton");
                  makeprofilebutton.unbind().on("click", {profilepictureid: pictureid}, function(event){
                     $.post("/sphere/<%= sphereobjectid %>/picture/"+event.data.profilepictureid+"/makeprofile",{}, function(){
                          location.reload(true);
                      }); 
                  });
                  
               }
            };
            var blueimpGallery = blueimp.Gallery(links, options);
         }
   });
</script>
<%
   if(isadmin) {
%>
        <% include /spherePictureUpload %>
        <% include /sendEmailValidation %>

    <script>
    $(document).ready(function(){
        $("#sphereBackgroundImage").click(function(){
            $("#addBackgroundPictureModal").modal("show");
        });
    });
    </script>
<%  } %>
   <!-- Slimscroll-->
   <script src="../../admin/app/vendor/slimscroll/jquery.slimscroll.min.js"></script>
   <script src="../../admin/app/js/app.js"></script>
   </body>
 
</html>